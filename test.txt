#import "meta.txt"
#import "basic.txt"

extern 
{
	array_push(array-dynamic, dynamic) : void	
	array_pop(array-dynamic) : dynamic
}

func get_calls() : void
{
	var module = get_current_module_index()
	
	// get all the expressions (flattened)
	var expr_list = get_module_expr_list(module, true)
	
	for var i = 0, i < len expr_list, i = i + 1 {
		var kind = get_expr_kind(expr_list[i])
		
		if kind == expr_kind_call {
			write format_string("found call at index %d", [i])
		}
	}
	
	var to_add = parse_code("run()")
	
	add_expr_to_module(module, to_add[0])
}

#on_compile get_calls()

func run() : void 
{
	var x = [] : number
	array_push(x, "hello")
	write x
}